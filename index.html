<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fid√∫cia Academy - Sistema de Treinamento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .admin-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #fbbf24;
            color: #000;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Timer */
        .timer-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }

        .timer-container.warning {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Login Admin */
        .admin-login {
            display: none;
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .admin-login h2 {
            color: #059669;
            margin-bottom: 20px;
            text-align: center;
        }

        .admin-login input {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .admin-login input:focus {
            outline: none;
            border-color: #059669;
        }

        .admin-login .error {
            color: #ef4444;
            font-size: 14px;
            margin-top: -10px;
            margin-bottom: 15px;
            display: none;
        }

        .content {
            padding: 30px;
        }

        /* TABS ADMIN */
        .admin-tabs {
            background: #f0fdf4;
            padding: 0;
            border-bottom: 2px solid #059669;
            display: none;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #047857;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: rgba(5, 150, 105, 0.1);
        }

        .tab-btn.active {
            color: #059669;
            border-bottom-color: #059669;
            background: white;
        }

        /* PAINEL ADMIN */
        .admin-panel {
            display: none;
        }

        .admin-tab-content {
            display: none;
            padding: 20px 0;
        }

        .admin-tab-content.active {
            display: block;
        }

        .admin-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
        }

        .admin-section h3 {
            color: #047857;
            margin-bottom: 15px;
            font-size: 18px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #bbf7d0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #059669;
            margin: 10px 0;
        }

        .stat-label {
            color: #047857;
            font-size: 13px;
            font-weight: 600;
        }

        /* Tables */
        .table-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-header {
            background: #f9fafb;
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h4 {
            color: #1f2937;
            font-size: 16px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f9fafb;
            padding: 10px 15px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            font-size: 12px;
            text-transform: uppercase;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f3f4f6;
            color: #1f2937;
            font-size: 14px;
        }

        tr:hover {
            background: #f9fafb;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .progress-bar-inline {
            background: #e5e7eb;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            display: inline-block;
            width: 100px;
            vertical-align: middle;
        }

        .progress-fill-inline {
            height: 100%;
            background: linear-gradient(90deg, #059669 0%, #047857 100%);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #059669;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
        }

        .checkbox-item:hover {
            background: #d1fae5;
        }

        .checkbox-item input {
            margin-right: 8px;
            cursor: pointer;
            width: auto;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            font-size: 13px;
        }

        .template-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .template-btn {
            padding: 10px;
            background: white;
            border: 2px solid #059669;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: 600;
            color: #059669;
        }

        .template-btn:hover {
            background: #059669;
            color: white;
        }

        .generated-link-box {
            display: none;
            background: #dbeafe;
            border: 2px solid #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .generated-link-box h4 {
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .link-display {
            background: white;
            padding: 12px;
            border-radius: 6px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 10px;
            border: 1px solid #93c5fd;
        }

        /* Dashboard Normal */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .module-card {
            background: linear-gradient(to bottom right, #f0fdf4, #dcfce7);
            border: 2px solid #bbf7d0;
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(5, 150, 105, 0.3);
            border-color: #059669;
        }

        .module-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .module-card.locked:hover {
            transform: none;
        }

        .module-card h3 {
            color: #059669;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .module-card p {
            color: #047857;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .module-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background: #fbbf24;
            color: #000;
        }

        .status-completed {
            background: #10b981;
            color: white;
        }

        .status-failed {
            background: #ef4444;
            color: white;
        }

        .attempts-info {
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }

        .welcome-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #059669;
            border-radius: 12px;
            padding: 18px 25px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.1);
        }

        .welcome-box h2 {
            color: #059669;
            margin-bottom: 8px;
            font-size: 22px;
            font-weight: 600;
        }

        .welcome-box p {
            color: #047857;
            margin: 0;
            font-size: 15px;
            line-height: 1.5;
        }

        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #059669 0%, #047857 100%);
            height: 100%;
            transition: width 0.3s;
        }

        .progress-text {
            text-align: center;
            color: #047857;
            font-size: 14px;
            margin-top: 5px;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(5, 150, 105, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-copy {
            background: #3b82f6;
        }

        .btn-copy:hover {
            background: #2563eb;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-export {
            background: #8b5cf6;
        }

        .btn-export:hover {
            background: #7c3aed;
        }

        /* Se√ß√µes ocultas */
        .training-section,
        .quiz-section,
        .result-section {
            display: none;
        }

        .lesson {
            background: #f0fdf4;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #059669;
        }

        .lesson h2 {
            color: #059669;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .lesson p {
            line-height: 1.8;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .question {
            background: #f0fdf4;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #059669;
        }

        .question h3 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            padding: 12px 20px;
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #059669;
            background: #d1fae5;
        }

        .option input {
            margin-right: 10px;
        }

        .btn-back {
            background: #6b7280;
            margin-bottom: 20px;
        }

        .score {
            font-size: 48px;
            font-weight: bold;
            color: #059669;
            margin: 20px 0;
        }

        .certificate {
            border: 3px solid #059669;
            padding: 40px;
            margin: 30px 0;
            background: linear-gradient(to bottom, #ffffff 0%, #f0fdf4 100%);
            position: relative;
        }

        .certificate::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px solid #047857;
            pointer-events: none;
        }

        .certificate h2 {
            color: #059669;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .certificate p {
            font-size: 18px;
            margin: 10px 0;
        }

        .certificate .company {
            font-size: 24px;
            font-weight: bold;
            color: #047857;
            margin: 20px 0;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #f59e0b;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
            .btn, .score, .btn-back, .admin-panel, .timer-container, .admin-tabs {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .modules-grid {
                grid-template-columns: 1fr;
            }
            .content {
                padding: 20px;
            }
            .timer-container {
                top: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 18px;
            }
            .admin-tabs {
                overflow-x: auto;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Timer -->
    <div id="timerContainer" class="timer-container">
        <span id="timerDisplay">30:00</span>
    </div>

    <div class="container">
        <div class="header">
            <div class="admin-badge" id="adminBadge" style="display: none;">üîß MODO ADMIN</div>
            <h1>üéì Fid√∫cia Academy</h1>
            <p>Bem-vindo a plataforma de treinamento dos produtos Fid√∫cia, complete ele todo e obtenha seu certificado</p>
        </div>

        <!-- TABS ADMIN -->
        <div class="admin-tabs" id="adminTabs">
            <button class="tab-btn active" onclick="switchAdminTab('generator')">üîó Gerar Links</button>
            <button class="tab-btn" onclick="switchAdminTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="switchAdminTab('clients')">üë• Clientes</button>
            <button class="tab-btn" onclick="switchAdminTab('history')">üìã Hist√≥rico</button>
            <button class="tab-btn" onclick="switchAdminTab('reports')">üìà Relat√≥rios</button>
        </div>

        <div class="content">
            <!-- Login Admin -->
            <div id="admin-login" class="admin-login">
                <h2>üîê Acesso Administrativo</h2>
                <input type="password" id="adminPassword" placeholder="Digite a senha" onkeypress="if(event.key==='Enter') checkAdminPassword()">
                <div class="error" id="loginError">‚ùå Senha incorreta!</div>
                <button class="btn" style="width: 100%;" onclick="checkAdminPassword()">Entrar</button>
            </div>

            <!-- PAINEL ADMIN -->
            <div id="admin-panel" class="admin-panel">
                <!-- TAB: Gerar Links -->
                <div id="admin-tab-generator" class="admin-tab-content active">
                    <h2 style="color: #059669; margin-bottom: 20px;">üîó Gerador de Links de Treinamento</h2>
                    
                    <div class="admin-section">
                        <h3>1Ô∏è‚É£ Templates R√°pidos</h3>
                        <div class="template-buttons">
                            <button class="template-btn" onclick="applyTemplate('completo')">üéØ Completo</button>
                            <button class="template-btn" onclick="applyTemplate('atendimento')">üë• Atendimento</button>
                            <button class="template-btn" onclick="applyTemplate('credito')">üí∞ Cr√©dito</button>
                            <button class="template-btn" onclick="applyTemplate('backoffice')">üìä Back Office</button>
                        </div>
                    </div>

                    <div class="admin-section">
                        <h3>2Ô∏è‚É£ Selecione os M√≥dulos</h3>
                        <div class="checkbox-grid" id="adminModulesCheckbox"></div>
                    </div>

                    <div class="admin-section">
                        <h3>3Ô∏è‚É£ Informa√ß√µes do Cliente</h3>
                        <div class="form-group">
                            <label>Nome da Empresa:</label>
                            <input type="text" id="adminCompanyName" placeholder="Ex: Banco ABC Ltda">
                        </div>
                        <div class="form-group">
                            <label>Email (opcional):</label>
                            <input type="email" id="adminCompanyEmail" placeholder="contato@empresa.com">
                        </div>
                    </div>

                    <button class="btn" onclick="generateAdminLink()">üöÄ Gerar Link</button>
                    <button class="btn btn-secondary" onclick="clearGeneratorForm()">üîÑ Limpar</button>

                    <div id="generatedLinkBox" class="generated-link-box">
                        <h4>‚úÖ Link Gerado com Sucesso!</h4>
                        <div class="link-display" id="generatedLinkDisplay"></div>
                        <button class="btn btn-copy btn-small" onclick="copyGeneratedLink()">üìã Copiar</button>
                        <button class="btn btn-secondary btn-small" onclick="testGeneratedLink()">üîç Testar</button>
                    </div>
                </div>

                <!-- TAB: Dashboard -->
                <div id="admin-tab-dashboard" class="admin-tab-content">
                    <h2 style="color: #059669; margin-bottom: 20px;">üìä Dashboard</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Links Gerados</div>
                            <div class="stat-number" id="stat-links">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Clientes Ativos</div>
                            <div class="stat-number" id="stat-clients">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Aprovados</div>
                            <div class="stat-number" id="stat-approved">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Pendentes</div>
                            <div class="stat-number" id="stat-pending">0</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h4>Clientes Pendentes</h4>
                            <button class="btn btn-small" onclick="refreshAdminData()">üîÑ Atualizar</button>
                        </div>
                        <div id="pending-table"></div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h4>Aprova√ß√µes Recentes</h4>
                        </div>
                        <div id="approved-table"></div>
                    </div>
                </div>

                <!-- TAB: Clientes -->
                <div id="admin-tab-clients" class="admin-tab-content">
                    <h2 style="color: #059669; margin-bottom: 20px;">üë• Clientes</h2>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h4>Lista de Clientes</h4>
                            <button class="btn btn-small btn-export" onclick="exportClients()">üì• Exportar CSV</button>
                        </div>
                        <div id="clients-table"></div>
                    </div>
                </div>

                <!-- TAB: Hist√≥rico -->
                <div id="admin-tab-history" class="admin-tab-content">
                    <h2 style="color: #059669; margin-bottom: 20px;">üìã Hist√≥rico de Links</h2>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h4>Links Gerados</h4>
                            <button class="btn btn-small btn-export" onclick="exportHistory()">üì• Exportar CSV</button>
                        </div>
                        <div id="history-table"></div>
                    </div>
                </div>

                <!-- TAB: Relat√≥rios -->
                <div id="admin-tab-reports" class="admin-tab-content">
                    <h2 style="color: #059669; margin-bottom: 20px;">üìà Relat√≥rios</h2>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h4>Desempenho por M√≥dulo</h4>
                        </div>
                        <div id="reports-table"></div>
                    </div>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-secondary" onclick="logout()">üö™ Sair do Painel Admin</button>
                </div>
            </div>

            <!-- Dashboard Normal -->
            <div id="dashboard">
                <div class="welcome-box">
                    <h2>Bem-vindo!</h2>
                    <p>Complete todos os treinamentos dispon√≠veis abaixo para obter seus certificados.</p>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText"></div>
                
                <div class="modules-grid" id="modulesGrid"></div>
            </div>

            <!-- Training Content -->
            <div id="training-section" class="training-section">
                <button class="btn btn-back" onclick="backToDashboard()">‚Üê Voltar aos M√≥dulos</button>
                <div id="trainingContent"></div>
                <div id="attemptsWarning"></div>
                <button class="btn" id="startQuizBtn" onclick="confirmStartQuiz()">Iniciar Avalia√ß√£o (10 quest√µes - 30 minutos)</button>
            </div>

            <!-- Quiz Section -->
            <div id="quiz-section" class="quiz-section">
                <div class="alert alert-warning">
                    ‚ö†Ô∏è <strong>Aten√ß√£o:</strong> A prova est√° em andamento. Voc√™ n√£o pode voltar at√© finalizar. Tempo: <span id="quizTimer">30:00</span>
                </div>
                <h2 style="color: #059669; margin-bottom: 20px;">Avalia√ß√£o em Andamento</h2>
                <p style="margin-bottom: 20px; color: #6b7280;"><strong>Responda as 10 quest√µes. Voc√™ precisa acertar no m√≠nimo 6 para ser aprovado.</strong></p>
                <div id="quizContent"></div>
                <button class="btn" onclick="submitQuiz()">Enviar Respostas</button>
            </div>

            <!-- Result Section -->
            <div id="result-section" class="result-section">
                <h2>Resultado da Avalia√ß√£o</h2>
                <div class="score" id="score"></div>
                <p id="feedback" style="font-size: 20px; margin: 20px 0;"></p>
                <div id="certificate-container"></div>
                <div>
                    <button class="btn" onclick="window.print()" id="printBtn" style="display:none;">üñ®Ô∏è Imprimir Certificado</button>
                    <button class="btn btn-secondary" onclick="backToDashboard()">‚Üê Voltar aos M√≥dulos</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // SENHA DO ADMIN
        const ADMIN_PASSWORD = "fiducia2025";

        // Configura√ß√£o dos m√≥dulos
        const trainingModules = {
            'abertura_contas': {
                title: 'Abertura de Contas',
                description: 'Processo completo de abertura de contas',
                content: [
                    { title: 'Documenta√ß√£o Necess√°ria', text: 'Para abrir uma conta, √© essencial verificar a documenta√ß√£o completa do cliente. Os documentos b√°sicos incluem RG, CPF, comprovante de resid√™ncia atualizado e comprovante de renda.' },
                    { title: 'Processo de Cadastro', text: 'O cadastro deve ser feito com aten√ß√£o aos detalhes. Verifique todos os dados pessoais, endere√ßo completo, telefones de contato e e-mail.' },
                    { title: 'Valida√ß√µes e Compliance', text: 'Realize todas as valida√ß√µes necess√°rias no sistema, incluindo consulta ao SERASA e verifica√ß√£o de PEP.' }
                ],
                questions: [
                    { question: 'Qual documento N√ÉO √© obrigat√≥rio para abertura de conta?', options: ['CPF', 'RG', 'T√≠tulo de Eleitor', 'Comprovante de Resid√™ncia'], correct: 2 },
                    { question: 'O que significa PEP?', options: ['Pessoa Exposta Politicamente', 'Protocolo de Endere√ßo Padr√£o', 'Processo Eletr√¥nico de Pagamento', 'Perfil Econ√¥mico do Pagador'], correct: 0 },
                    { question: 'Qual a import√¢ncia do comprovante de resid√™ncia?', options: ['N√£o √© importante', 'Validar endere√ßo do cliente', 'Apenas para arquivo', 'Exig√™ncia opcional'], correct: 1 },
                    { question: 'O que deve ser verificado no CPF?', options: ['Apenas se est√° correto', 'Regularidade e pend√™ncias', 'Data de emiss√£o', 'Local de emiss√£o'], correct: 1 },
                    { question: 'Quando fazer an√°lise de cr√©dito?', options: ['Depois de 30 dias', 'Nunca', 'Durante o processo de abertura', 'S√≥ se o cliente pedir'], correct: 2 },
                    { question: 'O que fazer se encontrar dados inconsistentes?', options: ['Ignorar', 'Solicitar corre√ß√£o ao cliente', 'Cadastrar assim mesmo', 'Cancelar o processo'], correct: 1 },
                    { question: 'Qual o prazo de validade do comprovante de resid√™ncia?', options: ['N√£o tem prazo', '90 dias', '180 dias', '1 ano'], correct: 1 },
                    { question: '√â obrigat√≥rio coletar telefone do cliente?', options: ['N√£o', 'Sim, pelo menos um contato', 'Apenas celular', 'Apenas fixo'], correct: 1 },
                    { question: 'O que √© compliance banc√°rio?', options: ['Sistema do banco', 'Conformidade com regras e leis', 'Tipo de conta', 'Setor do banco'], correct: 1 },
                    { question: 'Ap√≥s abrir a conta, o que deve ser entregue ao cliente?', options: ['Nada', 'Contrato e cart√£o', 'Apenas o n√∫mero da conta', 'Extrato'], correct: 1 }
                ]
            },
            'plataforma_credito': {
                title: 'Plataforma de Cr√©dito',
                description: 'An√°lise e concess√£o de cr√©dito',
                content: [
                    { title: 'Tipos de Cr√©dito', text: 'A plataforma oferece diversos produtos: cr√©dito pessoal, consignado, CDC, cheque especial e cart√£o de cr√©dito.' },
                    { title: 'An√°lise de Risco', text: 'A an√°lise considera score de cr√©dito, hist√≥rico de pagamentos, renda comprovada e comprometimento atual.' },
                    { title: 'Aprova√ß√£o e Limites', text: 'Os limites s√£o definidos automaticamente pelo sistema com base no perfil de risco.' }
                ],
                questions: [
                    { question: 'O que √© score de cr√©dito?', options: ['Saldo em conta', 'Pontua√ß√£o que indica risco de cr√©dito', 'Tipo de cr√©dito', 'Taxa de juros'], correct: 1 },
                    { question: 'Qual tipo de cr√©dito tem desconto em folha?', options: ['Pessoal', 'Consignado', 'CDC', 'Cheque especial'], correct: 1 },
                    { question: 'O que significa CDC?', options: ['Centro de Cr√©dito', 'Cr√©dito Direto ao Consumidor', 'Conta de Cr√©dito Digital', 'Controle de D√©bito'], correct: 1 },
                    { question: 'Comprometimento de renda acima de quanto √© preocupante?', options: ['10%', '30%', '50%', '70%'], correct: 2 },
                    { question: 'O que fazer se o sistema recusar automaticamente?', options: ['Liberar mesmo assim', 'Solicitar an√°lise manual', 'Ignorar', 'Aumentar o limite'], correct: 1 },
                    { question: 'Qual documento comprova renda de aut√¥nomo?', options: ['Holerite', 'Decore ou imposto de renda', 'Extrato banc√°rio', 'N√£o precisa comprovar'], correct: 1 },
                    { question: 'O que √© rating de risco?', options: ['Taxa de juros', 'Classifica√ß√£o do perfil do cliente', 'Tipo de conta', 'Limite de cr√©dito'], correct: 1 },
                    { question: 'Cr√©dito pr√©-aprovado pode ser recusado?', options: ['N√£o, √© garantido', 'Sim, se houver mudan√ßa no perfil', 'Apenas em casos criminais', 'Nunca'], correct: 1 },
                    { question: 'Qual a import√¢ncia do hist√≥rico de pagamento?', options: ['Nenhuma', 'Indica comportamento futuro do cliente', 'S√≥ para arquivo', 'Apenas estat√≠stica'], correct: 1 },
                    { question: 'O que fazer se cliente discordar da an√°lise?', options: ['Ignorar', 'Explicar os crit√©rios usados', 'Mudar a decis√£o', 'Encerrar atendimento'], correct: 1 }
                ]
            },
            'analise_contas': {
                title: 'An√°lise de Contas',
                description: 'Monitoramento e an√°lise de contas',
                content: [
                    { title: 'Movimenta√ß√£o Financeira', text: 'Analise o padr√£o de movimenta√ß√£o: entradas regulares, d√©bitos recorrentes e saldo m√©dio.' },
                    { title: 'Indicadores de Alerta', text: 'Fique atento a saques frequentes, transfer√™ncias suspeitas e movimenta√ß√£o incompat√≠vel.' },
                    { title: 'Relat√≥rios e Compliance', text: 'Documente todas as an√°lises realizadas e reporte casos suspeitos.' }
                ],
                questions: [
                    { question: 'O que √© movimenta√ß√£o at√≠pica?', options: ['Movimenta√ß√£o normal', 'Diferente do padr√£o habitual', 'Apenas d√©bitos', 'Apenas cr√©ditos'], correct: 1 },
                    { question: 'Saque acima de R$ 50.000 exige:', options: ['Nada especial', 'Comunica√ß√£o ao COAF', 'Autoriza√ß√£o do gerente', 'Apenas registro'], correct: 1 },
                    { question: 'O que √© saldo m√©dio?', options: ['Saldo atual', 'M√©dia dos saldos em per√≠odo', 'Maior saldo', 'Saldo m√≠nimo'], correct: 1 },
                    { question: 'D√©bitos recorrentes s√£o:', options: ['Aleat√≥rios', 'Pagamentos regulares', 'Saques', 'Transfer√™ncias'], correct: 1 },
                    { question: 'O que fazer ao identificar fraude?', options: ['Ignorar', 'Bloquear e reportar', 'Avisar cliente', 'Continuar normal'], correct: 1 },
                    { question: 'Uso excessivo de cheque especial indica:', options: ['Bom cliente', 'Dificuldade financeira', 'Nada relevante', 'Cliente VIP'], correct: 1 },
                    { question: 'O que √© COAF?', options: ['Banco', 'Conselho de Controle de Atividades Financeiras', 'Tipo de conta', 'Sistema'], correct: 1 },
                    { question: 'Transfer√™ncias suspeitas devem ser:', options: ['Ignoradas', 'Analisadas e reportadas', 'Canceladas', 'Autorizadas'], correct: 1 },
                    { question: 'Per√≠odo ideal para an√°lise:', options: ['1 dia', '1 semana', 'M√≠nimo 3 meses', '1 ano'], correct: 2 },
                    { question: 'Movimenta√ß√£o incompat√≠vel com renda:', options: ['√â normal', 'Requer investiga√ß√£o', 'Encerrar conta', 'Ignorar'], correct: 1 }
                ]
            },
            'emissao_ccb': {
                title: 'Emiss√£o de CCB',
                description: 'C√©dula de Cr√©dito Banc√°rio',
                content: [
                    { title: 'O que √© CCB', text: 'A C√©dula de Cr√©dito Banc√°rio √© um t√≠tulo que formaliza opera√ß√µes de empr√©stimo.' },
                    { title: 'Dados Obrigat√≥rios', text: 'A CCB deve conter valor, taxa de juros, prazo, forma de pagamento e dados do devedor.' },
                    { title: 'Assinatura e Valida√ß√£o', text: 'A CCB s√≥ tem validade com assinatura do cliente, f√≠sica ou digital.' }
                ],
                questions: [
                    { question: 'O que √© CCB?', options: ['Conta Corrente Banc√°ria', 'C√©dula de Cr√©dito Banc√°rio', 'Centro de Cr√©dito', 'Cart√£o de Cr√©dito'], correct: 1 },
                    { question: 'A CCB √© um:', options: ['Documento informal', 'T√≠tulo de cr√©dito', 'Tipo de conta', 'Cart√£o'], correct: 1 },
                    { question: 'Assinatura digital precisa de:', options: ['Nada especial', 'Certificado digital v√°lido', 'Testemunha', 'Cart√≥rio'], correct: 1 },
                    { question: 'Qual N√ÉO √© obrigat√≥rio na CCB:', options: ['Valor', 'Taxa de juros', 'Nome da m√£e', 'Prazo'], correct: 2 },
                    { question: 'CCB sem assinatura √©:', options: ['V√°lida', 'Inv√°lida', 'V√°lida por 30 dias', 'Depende do valor'], correct: 1 },
                    { question: 'Garantias na CCB s√£o:', options: ['Sempre obrigat√≥rias', 'Opcionais conforme caso', 'Proibidas', 'S√≥ valores altos'], correct: 1 },
                    { question: 'Onde armazenar CCB:', options: ['Apenas f√≠sico', 'Sistema digital', 'Com cliente', 'N√£o precisa'], correct: 1 },
                    { question: 'Cliente recusa assinar:', options: ['For√ßar', 'N√£o liberar cr√©dito', 'Assinar por ele', 'Liberar'], correct: 1 },
                    { question: 'CCB pode ser alterada:', options: ['Sim, sempre', 'N√£o, apenas com aditivo', 'Sim, gerente', 'Nunca'], correct: 1 },
                    { question: 'Fun√ß√£o da CCB:', options: ['Decorativa', 'Formalizar empr√©stimo', 'Controle interno', 'Marketing'], correct: 1 }
                ]
            },
            'emissao_cartoes': {
                title: 'Emiss√£o de Cart√µes',
                description: 'Gest√£o de cart√µes banc√°rios',
                content: [
                    { title: 'Tipos de Cart√µes', text: 'Cart√£o de d√©bito, cr√©dito, m√∫ltiplo e pr√©-pago. Cada tipo tem requisitos diferentes.' },
                    { title: 'Processo de Solicita√ß√£o', text: 'Verifique conta ativa, documenta√ß√£o e an√°lise de cr√©dito (para cart√£o de cr√©dito).' },
                    { title: 'Ativa√ß√£o e Senhas', text: 'Oriente sobre ativa√ß√£o via app, site ou telefone, e cadastro de senha segura.' }
                ],
                questions: [
                    { question: 'Cart√£o m√∫ltiplo combina:', options: ['Dois cr√©ditos', 'D√©bito e cr√©dito', 'Dois d√©bitos', 'Cr√©dito e pr√©-pago'], correct: 1 },
                    { question: 'Para cart√£o de cr√©dito √© obrigat√≥rio:', options: ['Apenas conta', 'An√°lise de cr√©dito aprovada', 'S√≥ CPF', 'Nada especial'], correct: 1 },
                    { question: 'Prazo de entrega:', options: ['24 horas', '10 dias √∫teis', '30 dias', '2 meses'], correct: 1 },
                    { question: 'Senha deve ter:', options: ['4 d√≠gitos', '6 d√≠gitos', '8 d√≠gitos', 'Livre'], correct: 0 },
                    { question: 'Cart√£o n√£o chega:', options: ['Aguardar', 'Solicitar 2¬™ via', 'Ir ao banco', 'Desistir'], correct: 1 },
                    { question: 'Cart√£o pr√©-pago precisa de:', options: ['An√°lise cr√©dito', 'Apenas carga', 'Comprovante renda', 'Garantias'], correct: 1 },
                    { question: 'Cliente pode ter:', options: ['Apenas 1', 'Conforme pol√≠tica', 'Ilimitado', 'M√°ximo 3'], correct: 1 },
                    { question: 'Ativa√ß√£o pode ser por:', options: ['Apenas ag√™ncia', 'App, site ou telefone', 'S√≥ telefone', 'Correio'], correct: 1 },
                    { question: 'Esqueceu senha:', options: ['Dar senha antiga', 'Recupera√ß√£o/redefini√ß√£o', 'Novo cart√£o', 'Nada'], correct: 1 },
                    { question: 'Cart√£o clonado:', options: ['Ignorar', 'Bloquear imediatamente', 'Usar normal', 'Trocar depois'], correct: 1 }
                ]
            },
            'med': {
                title: 'MED - M√°quina de Dep√≥sito',
                description: 'Opera√ß√£o de m√°quinas de dep√≥sito',
                content: [
                    { title: 'Funcionamento da MED', text: 'Permite dep√≥sitos em dinheiro e cheque sem envelope. Aceita at√© 50 notas por transa√ß√£o.' },
                    { title: 'Processo de Dep√≥sito', text: 'Cliente insere cart√£o, senha, escolhe dep√≥sito, insere notas. M√°quina conta automaticamente.' },
                    { title: 'Resolu√ß√£o de Problemas', text: 'Notas rasgadas podem ser rejeitadas. M√°quina travada: acionar suporte t√©cnico.' }
                ],
                questions: [
                    { question: 'MED aceita quantas notas:', options: ['10', '20', '50', '100'], correct: 2 },
                    { question: 'Precisa de envelope:', options: ['Sim', 'N√£o', '√Äs vezes', 'S√≥ cheque'], correct: 1 },
                    { question: 'Nota rasgada:', options: ['Sempre aceita', 'Geralmente n√£o', 'Depende valor', 'S√≥ grandes'], correct: 1 },
                    { question: 'Quem conta:', options: ['Cliente', 'Funcion√°rio', 'M√°quina', 'Gerente'], correct: 2 },
                    { question: 'Comprovante deve ser:', options: ['Descartado', 'Guardado', 'Na m√°quina', 'Enviado'], correct: 1 },
                    { question: 'Valor errado:', options: ['Confirmar', 'Cancelar e revisar', 'Chamar pol√≠cia', 'Ir embora'], correct: 1 },
                    { question: 'MED travou:', options: ['For√ßar', 'Acionar suporte', 'Ir embora', 'Esperar'], correct: 1 },
                    { question: 'Dep√≥sito cheque:', options: ['Imposs√≠vel', 'Poss√≠vel', 'S√≥ ag√™ncias', 'Proibido'], correct: 1 },
                    { question: 'Hor√°rio:', options: ['Comercial', '24h conforme local', 'S√≥ manh√£', 'S√≥ tarde'], correct: 1 },
                    { question: 'N√£o reconhece cart√£o:', options: ['For√ßar', 'Tentar novamente', 'Desistir', 'Ligar pol√≠cia'], correct: 1 }
                ]
            },
            'cabine': {
                title: 'Cabine de Autoatendimento',
                description: 'Suporte em cabines',
                content: [
                    { title: 'Servi√ßos Dispon√≠veis', text: 'Saques, dep√≥sitos, extratos, pagamentos, transfer√™ncias e segunda via de documentos.' },
                    { title: 'Atendimento ao Cliente', text: 'Auxilie sem fazer opera√ß√µes pelo cliente. Ensine passo a passo.' },
                    { title: 'Seguran√ßa', text: 'Fique atento a fraudes: pessoas tentando ver senhas ou oferecendo ajuda suspeita.' }
                ],
                questions: [
                    { question: 'Na cabine √© poss√≠vel:', options: ['Apenas saques', 'Diversos servi√ßos', 'S√≥ dep√≥sitos', 'Apenas consultas'], correct: 1 },
                    { question: 'Funcion√°rio pode digitar senha:', options: ['Sim', 'N√£o, nunca', '√Äs vezes', 'Com autoriza√ß√£o'], correct: 1 },
                    { question: 'Cliente com dificuldade:', options: ['Fazer por ele', 'Ensinar passo a passo', 'Ignorar', 'Mandar ao caixa'], correct: 1 },
                    { question: 'Pessoa oferecendo ajuda:', options: ['√â normal', 'Poss√≠vel fraude', 'Incentivar', 'Ignorar'], correct: 1 },
                    { question: 'Limite de saque:', options: ['Ilimitado', 'Conforme pol√≠tica', 'R$ 100', 'R$ 1.000'], correct: 1 },
                    { question: 'Cart√£o esquecido:', options: ['Deixar', 'Recolher e devolver', 'Ficar', 'Jogar fora'], correct: 1 },
                    { question: 'Extrato impresso:', options: ['Deixar', 'Entregar ao cliente', 'Descartar', 'Arquivar'], correct: 1 },
                    { question: 'M√°quina sem dinheiro:', options: ['For√ßar', 'Orientar outro caixa', 'Abrir', 'Ignorar'], correct: 1 },
                    { question: 'Hor√°rio das cabines:', options: ['24h ou conforme', 'S√≥ comercial', 'S√≥ manh√£', 'Meio-dia'], correct: 0 },
                    { question: 'Comportamento suspeito:', options: ['Ignorar', 'Reportar', 'Confrontar', 'Filmar'], correct: 1 }
                ]
            },
            'emissao_boleto': {
                title: 'Emiss√£o de Boleto',
                description: 'Gera√ß√£o de boletos banc√°rios',
                content: [
                    { title: 'Tipos de Boleto', text: 'Boleto registrado (rastre√°vel) √© obrigat√≥rio desde 2018. Cont√©m c√≥digo de barras e linha digit√°vel.' },
                    { title: 'Gera√ß√£o de Boleto', text: 'Informe valor, vencimento, dados do pagador e descri√ß√£o. Sistema gera c√≥digo √∫nico.' },
                    { title: 'Gest√£o e Baixa', text: 'Acompanhe status: pendente, pago, vencido, cancelado. Baixa √© autom√°tica ap√≥s pagamento.' }
                ],
                questions: [
                    { question: 'Boleto registrado desde:', options: ['2015', '2018', '2020', '2022'], correct: 1 },
                    { question: 'C√≥digo de barras serve para:', options: ['Decora√ß√£o', 'Leitura autom√°tica', 'Identificar banco', 'Nada'], correct: 1 },
                    { question: 'Boleto pode ser enviado por:', options: ['S√≥ correio', 'Email, app ou impresso', 'Apenas WhatsApp', 'S√≥ pessoalmente'], correct: 1 },
                    { question: 'Ap√≥s vencimento:', options: ['Boleto some', 'Pode ter multa e juros', 'Nada muda', 'N√£o pode pagar'], correct: 1 },
                    { question: 'Dados obrigat√≥rios N√ÉO incluem:', options: ['Valor', 'Vencimento', 'Cor favorita', 'Dados pagador'], correct: 2 },
                    { question: 'Baixa ap√≥s pagamento:', options: ['Manual', 'Autom√°tica', 'Opcional', 'Desnecess√°ria'], correct: 1 },
                    { question: 'Para cancelar:', options: ['Rasgar', 'Usar procedimento', 'Ligar cliente', 'Nada'], correct: 1 },
                    { question: 'Linha digit√°vel √©:', options: ['Decora√ß√£o', 'C√≥digo alternativo', 'Telefone banco', 'Nada'], correct: 1 },
                    { question: 'Boleto pago mas n√£o atualizou:', options: ['Pagar novamente', 'Verificar compensa√ß√£o', 'Ignorar', '√â fraude'], correct: 1 },
                    { question: 'Benefici√°rio √©:', options: ['Quem paga', 'Quem recebe', 'O banco', 'Ningu√©m'], correct: 1 }
                ]
            }
        };

        // Templates de perfis
        const profileTemplates = {
            completo: ['abertura_contas', 'plataforma_credito', 'analise_contas', 'emissao_ccb', 'emissao_cartoes', 'med', 'cabine', 'emissao_boleto'],
            atendimento: ['abertura_contas', 'emissao_cartoes', 'med', 'cabine', 'emissao_boleto'],
            credito: ['plataforma_credito', 'analise_contas', 'emissao_ccb'],
            backoffice: ['analise_contas', 'emissao_ccb', 'emissao_boleto']
        };

        // Estado da aplica√ß√£o
        let activeModules = [];
        let currentModule = null;
        let userProgress = {};
        let companyName = '';
        let isAdminMode = false;
        let generatedLink = '';
        let quizInProgress = false;
        let timerInterval = null;
        let timeRemaining = 1800;
        let generatedLinks = [];
        let clientsData = [];

        // Constantes
        const MAX_ATTEMPTS = 3;
        const QUIZ_TIME_MINUTES = 30;

        // Fun√ß√£o para embaralhar array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Inicializa√ß√£o
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const modulesParam = urlParams.get('modulos');
            companyName = urlParams.get('empresa') || '';
            const adminParam = urlParams.get('admin');

            // Carregar dados admin
            generatedLinks = JSON.parse(localStorage.getItem('fiducia_links') || '[]');
            clientsData = JSON.parse(localStorage.getItem('fiducia_clients_data') || '[]');

            if (adminParam === 'true') {
                isAdminMode = true;
                showAdminLogin();
                return;
            }

            if (modulesParam) {
                activeModules = modulesParam.split(',');
            } else if (!isAdminMode) {
                activeModules = Object.keys(trainingModules);
            }

            const storageKey = `training_progress_${modulesParam || 'default'}`;
            const savedProgress = localStorage.getItem(storageKey);
            if (savedProgress) {
                userProgress = JSON.parse(savedProgress);
            }

            // Salvar dados do cliente
            if (companyName && modulesParam) {
                saveClientData();
            }

            loadDashboard();
        }

        // Salvar dados do cliente
        function saveClientData() {
            const clientIndex = clientsData.findIndex(c => c.name === companyName);
            
            if (clientIndex === -1) {
                clientsData.push({
                    name: companyName,
                    modules: activeModules,
                    progress: userProgress,
                    createdAt: new Date().toISOString(),
                    lastAccess: new Date().toISOString()
                });
            } else {
                clientsData[clientIndex].progress = userProgress;
                clientsData[clientIndex].lastAccess = new Date().toISOString();
            }

            localStorage.setItem('fiducia_clients_data', JSON.stringify(clientsData));
        }

        // Mostrar login admin
        function showAdminLogin() {
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
        }

        // Verificar senha admin
        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('admin-login').style.display = 'none';
                showAdminPanel();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        }

        // Logout
        function logout() {
            window.location.href = window.location.pathname;
        }

        // Mostrar painel admin
        function showAdminPanel() {
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('adminBadge').style.display = 'block';
            document.getElementById('adminTabs').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';

            // Renderizar checkboxes
            const container = document.getElementById('adminModulesCheckbox');
            container.innerHTML = '';
            
            Object.keys(trainingModules).forEach(moduleId => {
                const module = trainingModules[moduleId];
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="admin_${moduleId}" value="${moduleId}">
                    <label for="admin_${moduleId}">${module.title}</label>
                `;
                container.appendChild(div);
            });

            refreshAdminData();
        }

        // Switch admin tabs
        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`admin-tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') refreshAdminData();
            if (tabName === 'clients') renderClientsTable();
            if (tabName === 'history') renderHistoryTable();
            if (tabName === 'reports') renderReportsTable();
        }

        // Aplicar template
        function applyTemplate(type) {
            document.querySelectorAll('#adminModulesCheckbox input').forEach(cb => cb.checked = false);
            profileTemplates[type].forEach(moduleId => {
                const checkbox = document.getElementById(`admin_${moduleId}`);
                if (checkbox) checkbox.checked = true;
            });
        }

        // Gerar link no painel admin
        function generateAdminLink() {
            const baseUrl = window.location.origin + window.location.pathname;
            const selectedModules = [];
            
            document.querySelectorAll('#adminModulesCheckbox input:checked').forEach(cb => {
                selectedModules.push(cb.value);
            });

            if (selectedModules.length === 0) {
                alert('‚ö†Ô∏è Selecione pelo menos um m√≥dulo!');
                return;
            }

            const company = document.getElementById('adminCompanyName').value.trim();
            const email = document.getElementById('adminCompanyEmail').value.trim();

            if (!company) {
                alert('‚ö†Ô∏è Digite o nome da empresa!');
                return;
            }
            
            generatedLink = baseUrl + '?modulos=' + selectedModules.join(',');
            generatedLink += '&empresa=' + encodeURIComponent(company);

            // Salvar no hist√≥rico
            generatedLinks.push({
                id: Date.now(),
                company: company,
                email: email,
                modules: selectedModules,
                link: generatedLink,
                createdAt: new Date().toISOString()
            });

            localStorage.setItem('fiducia_links', JSON.stringify(generatedLinks));

            document.getElementById('generatedLinkDisplay').textContent = generatedLink;
            document.getElementById('generatedLinkBox').style.display = 'block';
            document.getElementById('generatedLinkBox').scrollIntoView({ behavior: 'smooth' });
        }

        // Copiar link gerado
        function copyGeneratedLink() {
            navigator.clipboard.writeText(generatedLink).then(() => {
                alert('‚úÖ Link copiado!');
            });
        }

        // Testar link gerado
        function testGeneratedLink() {
            window.open(generatedLink, '_blank');
        }

        // Limpar formul√°rio gerador
        function clearGeneratorForm() {
            document.getElementById('adminCompanyName').value = '';
            document.getElementById('adminCompanyEmail').value = '';
            document.querySelectorAll('#adminModulesCheckbox input').forEach(cb => cb.checked = false);
            document.getElementById('generatedLinkBox').style.display = 'none';
        }

        // Refresh admin data
        function refreshAdminData() {
            // Stats
            document.getElementById('stat-links').textContent = generatedLinks.length;
            document.getElementById('stat-clients').textContent = clientsData.length;

            let approved = 0;
            let pending = 0;

            clientsData.forEach(client => {
                const progress = client.progress || {};
                const modules = client.modules || [];
                const completed = Object.keys(progress).filter(m => progress[m]?.passed).length;
                
                if (completed === modules.length && modules.length > 0) {
                    approved++;
                } else {
                    pending++;
                }
            });

            document.getElementById('stat-approved').textContent = approved;
            document.getElementById('stat-pending').textContent = pending;

            renderPendingTable();
            renderApprovedTable();
        }

        // Renderizar tabela de pendentes
        function renderPendingTable() {
            const container = document.getElementById('pending-table');
            const pending = clientsData.filter(client => {
                const progress = client.progress || {};
                const modules = client.modules || [];
                const completed = Object.keys(progress).filter(m => progress[m]?.passed).length;
                return completed < modules.length;
            }).slice(0, 5);

            if (pending.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>‚úÖ Nenhum cliente pendente</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Cliente</th><th>M√≥dulos</th><th>Progresso</th></tr></thead><tbody>';
            
            pending.forEach(client => {
                const progress = client.progress || {};
                const modules = client.modules || [];
                const completed = Object.keys(progress).filter(m => progress[m]?.passed).length;
                const percentage = modules.length > 0 ? (completed / modules.length * 100) : 0;

                html += `
                    <tr>
                        <td><strong>${client.name}</strong></td>
                        <td>${modules.length} m√≥dulos</td>
                        <td>
                            ${completed}/${modules.length} (${Math.round(percentage)}%)
                            <div class="progress-bar-inline">
                                <div class="progress-fill-inline" style="width: ${percentage}%"></div>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Renderizar tabela de aprovados
        function renderApprovedTable() {
            const container = document.getElementById('approved-table');
            const approved = clientsData.filter(client => {
                const progress = client.progress || {};
                const modules = client.modules || [];
                const completed = Object.keys(progress).filter(m => progress[m]?.passed).length;
                return completed === modules.length && modules.length > 0;
            }).slice(0, 5);

            if (approved.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma aprova√ß√£o ainda</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Cliente</th><th>M√≥dulos</th><th>Data</th></tr></thead><tbody>';
            
            approved.forEach(client => {
                const date = new Date(client.lastAccess).toLocaleDateString('pt-BR');
                html += `
                    <tr>
                        <td><strong>${client.name}</strong></td>
                        <td><span class="badge badge-success">${client.modules.length} conclu√≠dos</span></td>
                        <td>${date}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Renderizar tabela de clientes
        function renderClientsTable() {
            const container = document.getElementById('clients-table');
            
            if (clientsData.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhum cliente cadastrado</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Cliente</th><th>M√≥dulos</th><th>Progresso</th><th>Status</th></tr></thead><tbody>';
            
            clientsData.forEach(client => {
                const progress = client.progress || {};
                const modules = client.modules || [];
                const completed = Object.keys(progress).filter(m => progress[m]?.passed).length;
                const percentage = modules.length > 0 ? (completed / modules.length * 100) : 0;
                
                let statusBadge = '<span class="badge badge-warning">Pendente</span>';
                if (completed === modules.length && modules.length > 0) {
                    statusBadge = '<span class="badge badge-success">Aprovado</span>';
                }

                html += `
                    <tr>
                        <td><strong>${client.name}</strong></td>
                        <td>${modules.length}</td>
                        <td>
                            ${completed}/${modules.length} (${Math.round(percentage)}%)
                            <div class="progress-bar-inline">
                                <div class="progress-fill-inline" style="width: ${percentage}%"></div>
                            </div>
                        </td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Renderizar hist√≥rico
        function renderHistoryTable() {
            const container = document.getElementById('history-table');
            
            if (generatedLinks.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhum link gerado</p></div>';
                return;
            }

            let html = '<table><thead><tr><th>Data</th><th>Cliente</th><th>M√≥dulos</th><th>A√ß√µes</th></tr></thead><tbody>';
            
            [...generatedLinks].reverse().forEach(link => {
                const date = new Date(link.createdAt).toLocaleDateString('pt-BR');
                html += `
                    <tr>
                        <td>${date}</td>
                        <td><strong>${link.company}</strong></td>
                        <td><span class="badge badge-info">${link.modules.length} m√≥dulos</span></td>
                        <td>
                            <button class="btn btn-small btn-copy" onclick="copySpecificLink('${link.link}')">üìã</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Copiar link espec√≠fico
        function copySpecificLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                alert('‚úÖ Link copiado!');
            });
        }

        // Renderizar relat√≥rios
        function renderReportsTable() {
            const container = document.getElementById('reports-table');
            const stats = {};

            Object.keys(trainingModules).forEach(mod => {
                stats[mod] = { total: 0, approved: 0, failed: 0, pending: 0 };
            });

            clientsData.forEach(client => {
                (client.modules || []).forEach(mod => {
                    stats[mod].total++;
                    const progress = (client.progress || {})[mod];
                    if (progress) {
                        if (progress.passed) stats[mod].approved++;
                        else stats[mod].failed++;
                    } else {
                        stats[mod].pending++;
                    }
                });
            });

            let html = '<table><thead><tr><th>M√≥dulo</th><th>Total</th><th>Aprovados</th><th>Reprovados</th><th>Pendentes</th><th>Taxa</th></tr></thead><tbody>';
            
            Object.keys(trainingModules).forEach(mod => {
                const s = stats[mod];
                const rate = s.total > 0 ? (s.approved / s.total * 100) : 0;
                
                html += `
                    <tr>
                        <td><strong>${trainingModules[mod].title}</strong></td>
                        <td>${s.total}</td>
                        <td><span class="badge badge-success">${s.approved}</span></td>
                        <td><span class="badge badge-danger">${s.failed}</span></td>
                        <td><span class="badge badge-warning">${s.pending}</span></td>
                        <td>
                            ${Math.round(rate)}%
                            <div class="progress-bar-inline">
                                <div class="progress-fill-inline" style="width: ${rate}%"></div>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Exportar clientes
        function exportClients() {
            let csv = 'Cliente,M√≥dulos,Completos,Pendentes,Status\n';
            clientsData.forEach(client => {
                const progress = client.progress || {};
                const modules = client.modules || [];
                const completed = Object.keys(progress).filter(m => progress[m]?.passed).length;
                const status = completed === modules.length && modules.length > 0 ? 'Aprovado' : 'Pendente';
                csv += `"${client.name}",${modules.length},${completed},${modules.length - completed},"${status}"\n`;
            });
            downloadCSV(csv, 'clientes.csv');
        }

        // Exportar hist√≥rico
        function exportHistory() {
            let csv = 'Data,Cliente,Email,M√≥dulos,Link\n';
            generatedLinks.forEach(link => {
                const date = new Date(link.createdAt).toLocaleString('pt-BR');
                csv += `"${date}","${link.company}","${link.email || ''}",${link.modules.length},"${link.link}"\n`;
            });
            downloadCSV(csv, 'historico.csv');
        }

        // Download CSV
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // Carregar Dashboard
        function loadDashboard() {
            const grid = document.getElementById('modulesGrid');
            grid.innerHTML = '';

            let completed = 0;
            const total = activeModules.length;

            activeModules.forEach(moduleId => {
                const module = trainingModules[moduleId];
                if (!module) return;

                const card = document.createElement('div');
                card.className = 'module-card';
                
                let statusClass = 'status-pending';
                let statusText = 'Pendente';
                let attemptsText = '';
                
                const attempts = userProgress[moduleId]?.attempts || 0;
                const remainingAttempts = MAX_ATTEMPTS - attempts;

                if (userProgress[moduleId]) {
                    if (userProgress[moduleId].passed) {
                        statusClass = 'status-completed';
                        statusText = `Conclu√≠do - ${userProgress[moduleId].score}/10`;
                        completed++;
                    } else if (attempts >= MAX_ATTEMPTS) {
                        statusClass = 'status-failed';
                        statusText = `Reprovado - Tentativas esgotadas`;
                        card.classList.add('locked');
                    } else {
                        statusClass = 'status-failed';
                        statusText = `N√£o aprovado - ${userProgress[moduleId].score}/10`;
                        attemptsText = `<div class="attempts-info">‚ö†Ô∏è ${remainingAttempts} tentativa(s) restante(s)</div>`;
                    }
                }

                card.innerHTML = `
                    <h3>${module.title}</h3>
                    <p>${module.description}</p>
                    <span class="module-status ${statusClass}">${statusText}</span>
                    ${attemptsText}
                `;
                
                if (!card.classList.contains('locked')) {
                    card.onclick = () => loadTraining(moduleId);
                }
                grid.appendChild(card);
            });

            const percentage = total > 0 ? (completed / total) * 100 : 0;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${completed} de ${total} treinamentos conclu√≠dos (${Math.round(percentage)}%)`;
        }

        // Carregar Treinamento
        function loadTraining(moduleId) {
            currentModule = moduleId;
            const module = trainingModules[moduleId];
            
            const content = document.getElementById('trainingContent');
            content.innerHTML = `<h2 style="color: #059669; margin-bottom: 20px;">${module.title}</h2>`;
            
            module.content.forEach(lesson => {
                content.innerHTML += `
                    <div class="lesson">
                        <h2>${lesson.title}</h2>
                        <p>${lesson.text}</p>
                    </div>
                `;
            });

            const attempts = userProgress[moduleId]?.attempts || 0;
            const remainingAttempts = MAX_ATTEMPTS - attempts;
            const warningDiv = document.getElementById('attemptsWarning');
            
            if (attempts > 0 && !userProgress[moduleId]?.passed) {
                warningDiv.innerHTML = `
                    <div class="alert alert-warning">
                        ‚ö†Ô∏è Voc√™ j√° tentou ${attempts} vez(es). Restam ${remainingAttempts} tentativa(s).
                    </div>
                `;
            } else {
                warningDiv.innerHTML = '';
            }

            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('training-section').style.display = 'block';
            window.scrollTo(0, 0);
        }

        // Confirmar in√≠cio da prova
        function confirmStartQuiz() {
            const attempts = userProgress[currentModule]?.attempts || 0;
            const remainingAttempts = MAX_ATTEMPTS - attempts;

            if (attempts >= MAX_ATTEMPTS) {
                alert('‚ùå Tentativas esgotadas.');
                return;
            }

            if (confirm(
                `‚ö†Ô∏è ATEN√á√ÉO!\n\n` +
                `‚Ä¢ ${QUIZ_TIME_MINUTES} minutos para completar\n` +
                `‚Ä¢ N√£o poder√° voltar at√© finalizar\n` +
                `‚Ä¢ Tentativa ${attempts + 1} de ${MAX_ATTEMPTS}\n` +
                `‚Ä¢ Perguntas em ordem aleat√≥ria\n\n` +
                `Iniciar agora?`
            )) {
                startQuiz();
            }
        }

        // Iniciar Quiz
        function startQuiz() {
            quizInProgress = true;
            const module = trainingModules[currentModule];
            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = '';

            const shuffledQuestions = shuffleArray(module.questions);

            shuffledQuestions.forEach((q, index) => {
                const optionsWithIndex = q.options.map((opt, i) => ({ text: opt, isCorrect: i === q.correct }));
                const shuffledOptions = shuffleArray(optionsWithIndex);
                
                quizContent.innerHTML += `
                    <div class="question">
                        <h3>${index + 1}. ${q.question}</h3>
                        <div class="options">
                            ${shuffledOptions.map((option, i) => `
                                <label class="option">
                                    <input type="radio" name="q${index}" value="${option.isCorrect ? '1' : '0'}">
                                    ${option.text}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            startTimer();
            document.getElementById('training-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'block';
            window.scrollTo(0, 0);

            window.onbeforeunload = function() {
                if (quizInProgress) return "A prova est√° em andamento.";
            };
        }

        // Timer
        function startTimer() {
            timeRemaining = QUIZ_TIME_MINUTES * 60;
            document.getElementById('timerContainer').style.display = 'block';
            updateTimerDisplay();

            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining === 300) {
                    document.getElementById('timerContainer').classList.add('warning');
                    alert('‚è∞ 5 minutos restantes!');
                }

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    alert('‚è∞ Tempo esgotado!');
                    submitQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
            document.getElementById('quizTimer').textContent = display;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('timerContainer').style.display = 'none';
            document.getElementById('timerContainer').classList.remove('warning');
            quizInProgress = false;
            window.onbeforeunload = null;
        }

        // Enviar Quiz
        function submitQuiz() {
            stopTimer();

            let score = 0;
            for (let i = 0; i < 10; i++) {
                const answer = document.querySelector(`input[name="q${i}"]:checked`);
                if (answer && answer.value === "1") score++;
            }

            const passed = score >= 6;
            const currentAttempts = userProgress[currentModule]?.attempts || 0;

            userProgress[currentModule] = {
                score: score,
                passed: passed,
                attempts: currentAttempts + 1,
                lastAttempt: new Date().toISOString(),
                date: new Date().toLocaleDateString('pt-BR')
            };

            const urlParams = new URLSearchParams(window.location.search);
            const modulesParam = urlParams.get('modulos');
            const storageKey = `training_progress_${modulesParam || 'default'}`;
            localStorage.setItem(storageKey, JSON.stringify(userProgress));

            saveClientData();

            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';
            document.getElementById('score').textContent = `${score}/10`;

            let feedback = '';
            let certificateHTML = '';
            const remainingAttempts = MAX_ATTEMPTS - userProgress[currentModule].attempts;

            if (passed) {
                feedback = 'üéâ Parab√©ns! Aprovado!';
                certificateHTML = generateCertificate(score);
                document.getElementById('printBtn').style.display = 'inline-block';
            } else if (remainingAttempts > 0) {
                feedback = `üìö N√£o atingiu 6 acertos. ${remainingAttempts} tentativa(s) restante(s).`;
                document.getElementById('printBtn').style.display = 'none';
            } else {
                feedback = '‚ùå Tentativas esgotadas.';
                document.getElementById('printBtn').style.display = 'none';
            }

            document.getElementById('feedback').textContent = feedback;
            document.getElementById('certificate-container').innerHTML = certificateHTML;
            window.scrollTo(0, 0);
        }

        // Gerar Certificado
        function generateCertificate(score) {
            const date = new Date().toLocaleDateString('pt-BR');
            const module = trainingModules[currentModule];
            const displayName = companyName || 'a empresa';

            return `
                <div class="certificate">
                    <h2>CERTIFICADO DE CONCLUS√ÉO</h2>
                    <p>Certificamos que</p>
                    <p class="company">${displayName}</p>
                    <p>concluiu com √™xito o treinamento de</p>
                    <p><strong>${module.title}</strong></p>
                    <p>com aproveitamento de <strong>${score}/10 (${(score/10*100)}%)</strong></p>
                    <p style="margin-top: 30px;">Data: ${date}</p>
                    <p style="margin-top: 20px; font-size: 14px; color: #6b7280;">Fid√∫cia Academy</p>
                </div>
            `;
        }

        // Navega√ß√£o
        function backToDashboard() {
            if (quizInProgress) {
                alert('‚ö†Ô∏è Finalize a prova!');
                return;
            }

            stopTimer();
            document.getElementById('training-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('result-section').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            loadDashboard();
            window.scrollTo(0, 0);
        }

        // Iniciar
        window.onload = init;
    </script>
</body>
</html>
